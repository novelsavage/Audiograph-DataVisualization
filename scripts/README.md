# 日本のアーティストデータ取得スクリプト

このディレクトリには、Spotify APIを使用して日本のアーティストのフィーチャリングネットワークデータを取得するスクリプトが含まれています。

## セットアップ

### 1. Spotify Developer Accountの作成

1. [Spotify Developer Dashboard](https://developer.spotify.com/dashboard)にアクセス
2. Spotifyアカウントでログイン
3. "Create an app"をクリック
4. アプリ名と説明を入力して作成
5. Client IDとClient Secretをコピー

### 2. 環境変数の設定

プロジェクトルートに`.env`ファイルを作成し、以下の内容を記述：

```
SPOTIFY_CLIENT_ID=your_client_id_here
SPOTIFY_CLIENT_SECRET=your_client_secret_here
```

**注意**: `.env`ファイルは`.gitignore`に追加することを推奨します。

### 3. 依存パッケージのインストール

```bash
pip install -r scripts/requirements.txt
```

または、conda環境を使用する場合：

```bash
conda activate base  # または適切な環境
pip install -r scripts/requirements.txt
```

## 使用方法

### 基本的な使用方法

```bash
python scripts/fetch_japanese_artists.py
```

### カスタマイズ

スクリプト内の以下のパラメータを変更できます：

- `search_japanese_artists()`の`genres`パラメータ: 検索するジャンル
- `search_japanese_artists()`の`limit`パラメータ: 各ジャンルから取得するアーティスト数
- `build_network_data()`の`max_artists`パラメータ: 処理する最大アーティスト数

## 出力

スクリプトは`public/japanese_featuring_network.json`にネットワークデータを保存します。

このファイルは、既存の`spotify_featuring_network.json`と同じ形式で、プロジェクトの可視化コンポーネントでそのまま使用できます。

## 改善された機能

### 主な改善点

1. **フィーチャリングアーティストの自動追加**
   - 検索結果に含まれていないフィーチャリングアーティストも自動的にノードに追加
   - これにより、エッジ数が大幅に増加します

2. **フィーチャリングがあるアーティストでフィルタリング**
   - `find_artists_with_featurings()`関数で、フィーチャリングがあるアーティストを事前に特定
   - 無駄なAPI呼び出しを削減し、効率的にデータを取得

3. **APIレートリミット対策の強化**
   - リクエスト間の待機時間を0.3秒に設定（1秒あたり約3リクエスト）
   - レート制限エラー（429）の自動検出とリトライ機能
   - バッチ処理による効率的な楽曲情報取得

4. **より多くのデータを取得**
   - 各アーティストから最大30曲を取得（デフォルト）
   - 処理するアーティスト数を200まで増加可能

### 現在のロジック

1. **アーティスト検索**: ジャンル（j-pop, j-rock, j-idol, anime）で日本のアーティストを検索
2. **フィルタリング**: フィーチャリングがあるアーティストを特定（オプション）
3. **楽曲取得**: 各アーティストの楽曲を取得し、複数のアーティストが参加している楽曲を特定
4. **ネットワーク構築**: 
   - メインアーティストとフィーチャリングアーティストの両方をノードに追加
   - コラボレーション関係をエッジとして記録

## 注意事項

### APIレートリミット

- Spotify APIにはレート制限があります（通常、1秒あたり数リクエスト）
- スクリプトは0.3秒/リクエストの待機時間を設定（安全な値）
- レート制限エラー（429）が発生した場合、自動的に待機してリトライします
- 200アーティストを処理する場合、約10分程度かかります

### パラメータ調整

スクリプト内の`main()`関数で以下のパラメータを調整できます：

```python
SEARCH_LIMIT = 100  # 各ジャンルから取得するアーティスト数
MAX_ARTISTS_TO_PROCESS = 200  # 処理する最大アーティスト数
MIN_TRACKS_PER_ARTIST = 30  # 各アーティストから取得する楽曲数
FILTER_BY_FEATURINGS = True  # フィーチャリングがあるアーティストでフィルタリング
```

### その他の注意事項

- 取得したデータの利用は、Spotifyの利用規約に従ってください
- 個人情報や著作権に関する情報は適切に扱ってください
- 大量のデータを取得する場合は、処理時間を考慮してください

## トラブルシューティング

### 認証エラー

- Client IDとClient Secretが正しく設定されているか確認
- `.env`ファイルがプロジェクトルートにあるか確認

### レート制限エラー

- スクリプト内の`time.sleep()`の値を増やす
- 処理するアーティスト数を減らす（`max_artists`パラメータ）

### データが少ない

- `limit`パラメータを増やす
- 検索するジャンルを追加する
- より多くのアーティストを処理する（`max_artists`パラメータ）

